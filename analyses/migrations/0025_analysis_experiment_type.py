# Generated by Django 5.1.2 on 2024-11-22 17:05

from django.db import migrations, models


def inherit_analysis_experiment_types(apps, schema_editor):
    Analysis = apps.get_model("analyses", "analysis")
    for analysis in Analysis.objects.all():
        if analysis.assembly:
            analysis.experiment_type = "ASSEM"
        if analysis.run:
            analysis.experiment_type = analysis.run.experiment_type or "UNKNO"
        analysis.save()


class Migration(migrations.Migration):

    dependencies = [
        ("analyses", "0024_run_instrument_model_run_instrument_platform"),
    ]

    operations = [
        migrations.AddField(
            model_name="analysis",
            name="experiment_type",
            field=models.CharField(
                choices=[
                    ("METAT", "Metatranscriptomic"),
                    ("METAG", "Metagenomic"),
                    ("AMPLI", "Amplicon"),
                    ("ASSEM", "Assembly"),
                    ("HYASS", "Hybrid assembly"),
                    ("LRASS", "Long-read assembly"),
                    ("METAB", "Metabarcoding"),
                    ("UNKNO", "Unknown"),
                ],
                default="UNKNO",
                max_length=5,
            ),
        ),
        migrations.RunPython(
            code=inherit_analysis_experiment_types,
            reverse_code=migrations.RunPython.noop,
        ),
    ]
